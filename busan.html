<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>ë¶€ì‚° 1ë°•2ì¼ ì—¬í–‰</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap" rel="stylesheet">
<style>
:root{--bg:#0a1628;--card:#132038;--card2:#1a2d4a;--acc:#38bdf8;--tx:#e8edf4;--dm:#6b8299;--bl:#3b82f6;--gn:#22c55e;--pp:#a855f7;--rd:#ef4444;--or:#f59e0b;--pk:#ec4899;--tl:#14b8a6;--cyan:#06b6d4}
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html,body{height:100%;overflow:hidden;font-family:'Noto Sans KR',sans-serif;background:var(--bg);color:var(--tx)}
.app{display:flex;flex-direction:column;height:100dvh}
.top{padding:max(env(safe-area-inset-top),8px) 16px 0;background:var(--bg);z-index:50}
.top h1{font-size:17px;font-weight:700;color:var(--acc)}.top p{font-size:11px;color:var(--dm);margin-top:2px}
.mtabs{display:flex;margin:8px 16px 0;border-radius:10px;overflow:hidden;border:1px solid rgba(255,255,255,.08)}
.mtab{flex:1;padding:9px 0;text-align:center;font-size:13px;font-weight:600;background:0;color:var(--dm);border:none;font-family:inherit;cursor:pointer;transition:.2s}
.mtab.on{background:rgba(56,189,248,.15);color:var(--acc)}
.panel{display:none;flex-direction:column;flex:1;min-height:0;overflow:hidden}.panel.v{display:flex}
.days{display:flex;gap:6px;padding:10px 16px 8px;overflow-x:auto;scrollbar-width:none}.days::-webkit-scrollbar{display:none}
.db{flex-shrink:0;padding:6px 12px;border-radius:20px;border:1px solid rgba(255,255,255,.08);background:0;color:var(--dm);font-size:12px;font-weight:600;font-family:inherit;cursor:pointer;white-space:nowrap}
.db.on{background:var(--acc);color:#000;border-color:var(--acc)}
.db .c{font-size:10px;font-weight:400;opacity:.7}
.vt{display:flex;margin:0 16px 8px;border-radius:8px;overflow:hidden;border:1px solid rgba(255,255,255,.08)}
.vb{flex:1;padding:7px 0;text-align:center;font-size:12px;font-weight:600;background:0;color:var(--dm);border:none;font-family:inherit;cursor:pointer}
.vb.on{background:rgba(56,189,248,.15);color:var(--acc)}
.mw{flex:1;position:relative;display:none;min-height:0}.mw.v{display:flex;flex-direction:column}
#map{width:100%;flex:1;min-height:200px}
#pmap{width:100%;height:100%}
.lw{flex:1;overflow-y:auto;display:none;padding:0 12px 120px;-webkit-overflow-scrolling:touch;min-height:0}.lw.v{display:block}
.ict{display:flex;flex-direction:column;flex:1;min-height:0;overflow:hidden}
@media(min-width:768px){.vt{display:none}.ict,.pcontent{flex-direction:row!important}.lw{display:block!important;width:400px;min-width:400px;flex:none!important;border-right:1px solid rgba(255,255,255,.06);padding-bottom:40px}.mw{display:flex!important;flex-direction:column!important;flex:1!important}#pmap{display:block!important;flex:1}}
.dh{padding:12px 4px 8px}.dh h2{font-size:16px;font-weight:700;color:var(--acc)}.dh p{font-size:12px;color:var(--dm);line-height:1.5;margin-top:4px}
.st{display:flex;gap:10px;padding:12px 10px;border-radius:10px;cursor:pointer;transition:.15s;position:relative}
.st:active,.st.on{background:var(--card2)}
.sn{width:30px;height:30px;min-width:30px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:12px;font-weight:700;color:#fff;margin-top:1px}
.sn.sight{background:var(--bl)}.sn.food{background:var(--gn)}.sn.cafe{background:var(--pk)}.sn.lodge{background:var(--or)}.sn.transport-marker{background:var(--pp)}
.si{flex:1;min-width:0}
.nm{font-size:13px;font-weight:600;line-height:1.35}.ne{font-size:11px;color:var(--dm);font-weight:400}
.sm{display:flex;gap:8px;margin-top:3px;font-size:11px;color:var(--dm)}.sm .tm{color:var(--acc);font-weight:600}
.nt{font-size:11px;color:var(--dm);line-height:1.55;margin-top:6px;display:none}
.st.on .nt{display:block}
.st-actions{display:none;gap:4px;margin-top:6px}
.st.on .st-actions{display:flex}
.sa{padding:4px 8px;border-radius:5px;border:none;font-size:10px;font-family:inherit;cursor:pointer;font-weight:500}
.sa.up{background:rgba(59,130,246,.1);color:var(--bl)}.sa.down{background:rgba(59,130,246,.1);color:var(--bl)}
.sa.del{background:rgba(239,68,68,.1);color:var(--rd)}
.tl{display:flex;padding:0 0 0 24px;min-height:6px}.tl-b{width:2px;background:rgba(255,255,255,.06)}
.tp{display:flex;align-items:flex-start;gap:8px;padding:4px 0 4px 15px}
.ti{width:22px;height:22px;min-width:22px;border-radius:5px;display:flex;align-items:center;justify-content:center;font-size:11px}
.ti.walk{background:rgba(59,130,246,.12);color:var(--bl)}.ti.metro{background:rgba(245,158,11,.12);color:var(--or)}.ti.bus{background:rgba(168,85,247,.12);color:var(--pp)}.ti.drive{background:rgba(20,184,166,.12);color:var(--tl)}.ti.transit{background:rgba(168,85,247,.12);color:var(--pp)}
.tt{font-size:11px;color:var(--dm);line-height:1.45}.tt b{color:var(--tx);font-weight:600}
.lgd{position:absolute;bottom:16px;left:12px;right:12px;z-index:5;display:flex;gap:12px;justify-content:center;background:rgba(10,22,40,.9);backdrop-filter:blur(8px);border-radius:10px;padding:8px 16px;border:1px solid rgba(255,255,255,.06)}
.lgd span{display:flex;align-items:center;gap:5px;font-size:11px;color:var(--dm)}.lgd i{width:9px;height:9px;border-radius:50%;display:inline-block}
.map-card{position:absolute;bottom:0;left:0;right:0;z-index:10;background:var(--card);border-radius:16px 16px 0 0;padding:16px 16px calc(10px + env(safe-area-inset-bottom));transform:translateY(100%);transition:transform .3s ease;box-shadow:0 -4px 20px rgba(0,0,0,.4);border-top:1px solid rgba(255,255,255,.08)}
.map-card.show{transform:translateY(0)}
.mc-handle{width:36px;height:4px;border-radius:2px;background:rgba(255,255,255,.15);margin:0 auto 12px}
.mc-top{display:flex;align-items:flex-start;gap:10px}
.mc-num{width:34px;height:34px;min-width:34px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:13px;font-weight:700;color:#fff}
.mc-info{flex:1;min-width:0}.mc-name{font-size:15px;font-weight:700;line-height:1.35}.mc-en{font-size:11px;color:var(--dm)}
.mc-meta{display:flex;gap:6px;margin-top:4px;flex-wrap:wrap}
.mc-meta span{font-size:10px;padding:2px 6px;border-radius:4px;font-weight:500}
.mc-close{width:28px;height:28px;border-radius:50%;background:rgba(255,255,255,.08);border:none;color:var(--dm);font-size:14px;cursor:pointer;display:flex;align-items:center;justify-content:center}
.mc-note{font-size:12px;color:var(--dm);line-height:1.6;margin-top:10px;padding-top:8px;border-top:1px solid rgba(255,255,255,.06)}
.mc-nav{display:flex;gap:8px;margin-top:10px}
.mc-nav button{flex:1;padding:8px;border-radius:8px;border:none;font-size:12px;font-weight:600;font-family:inherit;cursor:pointer}
.mc-nav .prev{background:rgba(255,255,255,.06);color:var(--dm)}.mc-nav .next{background:rgba(56,189,248,.15);color:var(--acc)}
.pbar{display:flex;gap:6px;padding:10px 16px 0;flex-wrap:wrap}
.pbtn{padding:5px 12px;border-radius:16px;border:1px solid rgba(255,255,255,.1);background:0;color:var(--dm);font-size:11px;font-weight:500;font-family:inherit;cursor:pointer}
.pbtn.on{border-color:var(--acc);color:var(--acc);background:rgba(56,189,248,.1)}
.pview{display:flex;margin:8px 16px;border-radius:8px;overflow:hidden;border:1px solid rgba(255,255,255,.08)}
.pvb{flex:1;padding:7px;text-align:center;font-size:12px;font-weight:600;background:0;color:var(--dm);border:none;font-family:inherit;cursor:pointer}.pvb.on{background:rgba(56,189,248,.15);color:var(--acc)}
.pcontent{display:flex;flex:1;overflow:hidden}
.plist{flex:1;overflow-y:auto;padding:8px 12px 120px;-webkit-overflow-scrolling:touch}
#pmap{display:none}
.pcard{background:var(--card);border-radius:12px;padding:14px;margin-bottom:8px}
.pcard.visited{opacity:.5}
.pcard-top{display:flex;align-items:flex-start;gap:10px}
.pcard-icon{width:36px;height:36px;min-width:36px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:16px}
.pcard-icon.food{background:rgba(34,197,94,.15)}.pcard-icon.cafe{background:rgba(236,72,153,.15)}.pcard-icon.sight{background:rgba(59,130,246,.15)}.pcard-icon.lodge{background:rgba(245,158,11,.15)}
.pcard-info{flex:1;min-width:0}.pcard-name{font-size:14px;font-weight:600}.pcard-en{font-size:11px;color:var(--dm)}
.pcard-meta{display:flex;gap:6px;margin-top:4px;flex-wrap:wrap}
.pcard-meta span{font-size:10px;padding:2px 6px;border-radius:4px;font-weight:500}
.pcard-detail{margin-top:8px;font-size:11px;color:var(--dm);line-height:1.6}
.pcard-detail div{margin-bottom:3px}
.pcard-actions{display:flex;gap:6px;margin-top:10px;flex-wrap:wrap}
.pact{padding:5px 10px;border-radius:6px;border:none;font-size:11px;font-family:inherit;cursor:pointer;font-weight:500}
.pact.visit{background:rgba(34,197,94,.15);color:var(--gn)}.pact.visit.done{background:rgba(34,197,94,.3);color:#fff}
.pact.del{background:rgba(239,68,68,.1);color:var(--rd)}
.pact.mapbtn{background:rgba(59,130,246,.1);color:var(--bl)}
.pact.additin{background:rgba(56,189,248,.15);color:var(--acc)}
.add-btn{position:fixed;bottom:calc(24px + env(safe-area-inset-bottom));right:20px;width:52px;height:52px;border-radius:50%;background:var(--acc);color:#000;font-size:24px;border:none;box-shadow:0 4px 16px rgba(0,0,0,.4);cursor:pointer;z-index:100;display:none}
.panel.v .add-btn{display:block}
.add-stop{display:flex;align-items:center;justify-content:center;gap:6px;padding:12px;margin:8px 4px;border-radius:10px;border:1px dashed rgba(255,255,255,.1);background:0;color:var(--dm);font-size:12px;font-family:inherit;cursor:pointer;width:calc(100% - 8px)}
.modal-bg{display:none;position:fixed;inset:0;background:rgba(0,0,0,.6);z-index:200;align-items:flex-end;justify-content:center}.modal-bg.v{display:flex}
.modal{background:var(--card);border-radius:16px 16px 0 0;width:100%;max-width:500px;max-height:85vh;overflow-y:auto;padding:24px 20px calc(20px + env(safe-area-inset-bottom));-webkit-overflow-scrolling:touch}
.modal h2{font-size:17px;font-weight:700;color:var(--acc);margin-bottom:16px}
.mfield{margin-bottom:12px}.mfield label{display:block;font-size:12px;color:var(--dm);margin-bottom:4px;font-weight:500}
.mfield input,.mfield textarea,.mfield select{width:100%;padding:10px 12px;border-radius:8px;border:1px solid rgba(255,255,255,.1);background:var(--bg);color:var(--tx);font-size:13px;font-family:inherit;outline:none}
.mfield textarea{height:60px;resize:none}.mfield select{-webkit-appearance:none}
.mrow{display:flex;gap:8px}.mrow .mfield{flex:1}
.mbtn-row{display:flex;gap:8px;margin-top:16px}
.mbtn{flex:1;padding:12px;border-radius:10px;border:none;font-size:14px;font-weight:600;font-family:inherit;cursor:pointer}
.mbtn.save{background:var(--acc);color:#000}.mbtn.cancel{background:rgba(255,255,255,.08);color:var(--dm)}
.daypick{display:flex;flex-wrap:wrap;gap:8px;margin:12px 0}
.daypick button{padding:10px 16px;border-radius:8px;border:1px solid rgba(255,255,255,.1);background:var(--bg);color:var(--tx);font-size:13px;font-family:inherit;cursor:pointer}
.daypick button:active{background:var(--acc);color:#000}
.empty{text-align:center;padding:60px 20px;color:var(--dm);font-size:13px}
.sync-btn{width:40px;height:40px;border-radius:50%;border:1px solid rgba(255,255,255,.1);background:var(--card);color:var(--acc);font-size:18px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:.3s;flex-shrink:0}
.day-badge{display:inline-flex;align-items:center;justify-content:center;min-width:22px;height:22px;padding:0 6px;border-radius:11px;font-size:10px;font-weight:700;cursor:pointer;transition:.2s}
.day-badge.set{background:var(--acc);color:#0a1628}.day-badge.unset{background:rgba(255,255,255,.08);color:var(--dm);border:1px dashed rgba(255,255,255,.15)}
.day-pick-row{display:flex;gap:4px;flex-wrap:wrap;margin-top:6px}
.day-pick-row button{width:28px;height:28px;border-radius:14px;border:1px solid rgba(255,255,255,.1);background:var(--card2);color:var(--tx);font-size:11px;font-weight:700;cursor:pointer;transition:.2s}
.day-pick-row button.active{background:var(--acc);color:#0a1628;border-color:var(--acc)}
.book-badge{display:inline-flex;align-items:center;gap:2px;padding:1px 6px;border-radius:4px;font-size:9px;font-weight:700;background:rgba(239,68,68,.15);color:#ef4444;cursor:pointer;border:1px solid rgba(239,68,68,.3);vertical-align:middle}
.book-tip{background:rgba(239,68,68,.08);border:1px solid rgba(239,68,68,.2);border-radius:8px;padding:10px 12px;margin-top:6px;font-size:11px;line-height:1.6;color:var(--tx);animation:fadeIn .2s}
.book-tip a{color:var(--acc);text-decoration:underline}
.book-tip .bt-title{font-weight:700;color:#ef4444;margin-bottom:4px;font-size:12px}
@keyframes fadeIn{from{opacity:0;transform:translateY(-4px)}to{opacity:1;transform:translateY(0)}}
.pac-container{background:var(--card)!important;border:1px solid rgba(255,255,255,.1)!important;border-radius:10px!important;margin-top:4px!important;font-family:'Noto Sans KR',sans-serif!important;z-index:10000!important;box-shadow:0 8px 24px rgba(0,0,0,.5)!important}
.pac-item{padding:12px 14px!important;border-top:1px solid rgba(255,255,255,.06)!important;color:var(--tx)!important;font-size:13px!important;cursor:pointer!important}
.pac-item:first-child{border-top:none!important}
.pac-item:hover,.pac-item-selected{background:var(--card2)!important}
.pac-item-query{color:var(--acc)!important;font-weight:600!important}
.pac-icon{display:none!important}.pac-matched{color:var(--acc)!important}
</style>
</head>
<body>
<div class="app">
<div class="top">
<div style="display:flex;align-items:center;justify-content:space-between">
<div><h1>ğŸŒŠ ë¶€ì‚° 1ë°•2ì¼ ì—¬í–‰</h1><p>ì¼ìš”ì¼~ì›”ìš”ì¼ Â· ì—¬ìœ ë¡œìš´ ë°”ë‹¤ íë§</p></div>
<div style="display:flex;gap:6px">
<button class="sync-btn" onclick="openExport()" style="font-size:9px;line-height:1.1;word-break:keep-all">êµ¬ê¸€ë§µ</button>
</div></div>
</div>
<div class="mtabs">
<button class="mtab on" onclick="mainTab('itin')" id="mt1">ğŸ“… ì¼ì •</button>
<button class="mtab" onclick="mainTab('places')" id="mt2">ğŸ“ ì €ì¥ì†Œ</button>
</div>
<!-- ITINERARY -->
<div class="panel v" id="itinPanel">
<div class="days" id="dy"></div>
<div class="vt"><button class="vb on" onclick="itinView('list')" id="iv2">ğŸ“‹ ì¼ì •ëª©ë¡</button><button class="vb" onclick="itinView('map')" id="iv1">ğŸ—º ì§€ë„</button></div>
<div class="ict">
<div class="lw v" id="lw"><div id="ls"></div></div>
<div class="mw" id="mw"><div id="map"></div>
<div class="lgd"><span><i style="background:var(--bl)"></i>ê´€ê´‘</span><span><i style="background:var(--gn)"></i>ë§›ì§‘</span><span><i style="background:var(--pk)"></i>ì¹´í˜</span><span><i style="background:var(--or)"></i>ìˆ™ì†Œ</span></div>
<div class="map-card" id="mapCard">
<div class="mc-handle"></div>
<div class="mc-top"><div class="mc-num" id="mcNum"></div>
<div class="mc-info"><div class="mc-name" id="mcName"></div><div class="mc-en" id="mcEn"></div><div class="mc-meta" id="mcMeta"></div></div>
<button class="mc-close" onclick="closeCard()">âœ•</button>
</div>
<div class="mc-note" id="mcNote"></div>
<div class="mc-nav"><button class="prev" onclick="navCard(-1)">â† ì´ì „</button><button class="next" onclick="navCard(1)">ë‹¤ìŒ â†’</button></div>
</div>
</div></div></div>
<!-- PLACES -->
<div class="panel" id="placesPanel">
<div class="pbar" id="pbar">
<button class="pbtn on" onclick="pf('all',this)">ì „ì²´</button>
<button class="pbtn" onclick="pf('food',this)">ğŸ½ï¸ ë§›ì§‘</button>
<button class="pbtn" onclick="pf('cafe',this)">â˜• ì¹´í˜</button>
<button class="pbtn" onclick="pf('sight',this)">ğŸ›ï¸ ê´€ê´‘</button>
</div>
<div class="pbar" id="pbar2" style="padding-top:6px">
<button class="pbtn" onclick="pf('d1',this)">D1</button>
<button class="pbtn" onclick="pf('d2',this)">D2</button>
<button class="pbtn" onclick="pf('unset',this)">ë¯¸ì •</button>
</div>
<div class="pview"><button class="pvb on" onclick="pview('list')" id="pv1">ğŸ“‹ ëª©ë¡</button><button class="pvb" onclick="pview('map')" id="pv2">ğŸ—º ì§€ë„</button></div>
<div class="pcontent">
<div class="plist" id="plist"></div>
<div class="mw" id="pmw" style="display:none"><div id="pmap"></div></div>
</div>
<button class="add-btn" onclick="openModal()">+</button>
</div>
<!-- ADD/EDIT MODAL -->
<div class="modal-bg" id="modal"><div class="modal">
<h2 id="modalTitle">ì¥ì†Œ ì¶”ê°€</h2>
<div class="mrow"><div class="mfield"><label>ì¹´í…Œê³ ë¦¬</label><select id="fCat"><option value="food">ğŸ½ï¸ ë§›ì§‘</option><option value="cafe">â˜• ì¹´í˜</option><option value="sight">ğŸ›ï¸ ê´€ê´‘</option></select></div>
<div class="mfield"><label>ì§€ì—­</label><select id="fCity"><option value="haeundae">í•´ìš´ëŒ€</option><option value="gwangalli">ê´‘ì•ˆë¦¬</option><option value="seomyeon">ì„œë©´</option><option value="nampo">ë‚¨í¬ë™</option><option value="yeongdo">ì˜ë„</option><option value="gijang">ê¸°ì¥</option><option value="other">ê¸°íƒ€</option></select></div></div>
<div class="mfield"><label>ì´ë¦„</label><input id="fName" placeholder="ì˜ˆ: ìˆ˜ë³€ìµœê³ ë¼ì§€êµ­ë°¥"></div>
<div class="mfield"><label>ê²€ìƒ‰ (Google Places)</label><input id="fSearch" placeholder="ì¥ì†Œ ê²€ìƒ‰..."></div>
<div class="mrow"><div class="mfield"><label>í‰ì </label><input id="fRating" type="number" step="0.1" min="0" max="5" placeholder="4.5"></div>
<div class="mfield"><label>ê°€ê²©ëŒ€</label><select id="fPrice"><option value="">ì„ íƒ</option><option value="â‚©">â‚© (~1ë§Œì›)</option><option value="â‚©â‚©">â‚©â‚© (~3ë§Œì›)</option><option value="â‚©â‚©â‚©">â‚©â‚©â‚© (3ë§Œì›+)</option><option value="ë¬´ë£Œ">ë¬´ë£Œ</option></select></div></div>
<div class="mrow"><div class="mfield"><label>ì˜ì—…ì‹œê°„</label><input id="fHours" placeholder="10:00~22:00"></div>
<div class="mfield"><label>íœ´ë¬´ì¼</label><input id="fClosed" placeholder="ì›”ìš”ì¼"></div></div>
<div class="mfield"><label>ì¶”ì²œë©”ë‰´/í•˜ì´ë¼ì´íŠ¸</label><input id="fMenu" placeholder="ë¼ì§€êµ­ë°¥, ìˆ˜ìœ¡"></div>
<div class="mfield"><label>í•œì¤„íŒ</label><textarea id="fTip" placeholder="íŒì„ ì…ë ¥í•˜ì„¸ìš”"></textarea></div>
<div class="mrow"><div class="mfield"><label>ìœ„ë„</label><input id="fLat" type="number" step="any" placeholder="35.158"></div>
<div class="mfield"><label>ê²½ë„</label><input id="fLng" type="number" step="any" placeholder="129.160"></div></div>
<p style="font-size:10px;color:var(--dm);margin-top:-4px">ğŸ’¡ Google Mapsì—ì„œ ì¥ì†Œ ê¸¸ê²Œ ëˆ„ë¥´ë©´ ì¢Œí‘œ ë³µì‚¬ ê°€ëŠ¥</p>
<div class="mfield"><label>ğŸ“… ëª‡ì¼ì°¨ ì¼ì •?</label>
<div class="day-pick-row" id="fDayRow">
<button type="button" onclick="pickFDay(1)">1</button><button type="button" onclick="pickFDay(2)">2</button>
<button type="button" style="width:auto;padding:0 10px;font-size:10px" onclick="pickFDay(0)">ë¯¸ì •</button>
</div></div>
<div class="mbtn-row"><button class="mbtn cancel" onclick="closeModal()">ì·¨ì†Œ</button><button class="mbtn save" onclick="savePlace()">ì €ì¥</button></div>
</div></div>
<!-- DAY PICKER -->
<div class="modal-bg" id="dayModal"><div class="modal">
<h2>ì–´ëŠ ë‚ ì— ì¶”ê°€í• ê¹Œìš”?</h2>
<div class="daypick" id="dayPick"></div>
<div class="mbtn-row"><button class="mbtn cancel" onclick="closeDayModal()">ì·¨ì†Œ</button></div>
</div></div>
<!-- EXPORT -->
<div class="modal-bg" id="exportModal"><div class="modal">
<h2>ğŸ“¤ Google Mapsì—ì„œ ì—´ê¸°</h2>
<p style="font-size:12px;color:var(--dm);margin-bottom:12px">íƒ­í•˜ë©´ Google Mapsì—ì„œ ë°”ë¡œ ì—´ë ¤ìš”.</p>
<div style="display:flex;flex-direction:column;gap:6px">
<button class="mbtn save" onclick="openInGmaps('day')" style="text-align:left;padding:12px">ğŸ“… í˜„ì¬ ì¼ì • (Day <span id="expDay">1</span>)</button>
<button class="mbtn save" onclick="openInGmaps('food')" style="text-align:left;padding:12px">ğŸ½ï¸ ë§›ì§‘</button>
<button class="mbtn save" onclick="openInGmaps('cafe')" style="text-align:left;padding:12px">â˜• ì¹´í˜</button>
<button class="mbtn save" onclick="openInGmaps('sight')" style="text-align:left;padding:12px">ğŸ›ï¸ ê´€ê´‘ì§€</button>
</div>
<div class="mbtn-row" style="margin-top:12px"><button class="mbtn cancel" onclick="closeExport()">ë‹«ê¸°</button></div>
</div></div>
</div>

<script>
// ===== CONFIG =====
const LS_PLACES='bs_places';
const LS_DAYS='bs_days';
const DATA_VER=1;

// ===== SEED DATA =====
const SEED_PLACES=[
// == DAY 1 ë§›ì§‘ (ì¼ìš”ì¼) ==
{id:'s1',cat:"food",city:"haeundae",name:"ìˆ˜ë³€ìµœê³ ë¼ì§€êµ­ë°¥",rating:4.5,price:"â‚©",hours:"08:00~04:00",menu:"í•­ì •êµ­ë°¥, ìˆ˜ìœ¡",tip:"24ì‹œê°„ê¸‰! ì•„ì¹¨ í•´ì¥ìœ¼ë¡œ ìµœê³ . í•­ì •ì‚´ì´ ë‘íˆ¼í•´ìš”.",lat:35.1537,lng:129.1178,visited:false,day:1},
{id:'s2',cat:"food",city:"haeundae",name:"í•´ìš´ëŒ€ ì›ì¡°í• ë§¤êµ­ë°¥",rating:4.3,price:"â‚©",hours:"24ì‹œê°„",menu:"ë¼ì§€êµ­ë°¥, ë‚´ì¥êµ­ë°¥",tip:"í•´ìš´ëŒ€ 40ë…„ ë…¸í¬. ë“ ë“ í•œ í•œ ë¼!",lat:35.1622,lng:129.1635,visited:false,day:1},
{id:'s3',cat:"food",city:"gwangalli",name:"ê°œë¯¸ì§‘",rating:4.6,price:"â‚©â‚©",hours:"11:00~22:00",closed:"í™”",menu:"ë§¤ìš´ ë‚™ê³±ìƒˆ",tip:"ê´‘ì•ˆë¦¬ ë§¤ìš´ë§› ì„±ì§€! ì•ˆ ë§¤ìš´ë§›ë„ ê°€ëŠ¥.",lat:35.1534,lng:129.1188,visited:false,day:1},
{id:'s4',cat:"food",city:"gwangalli",name:"ìœµìº‰ì°Œì—",rating:4.7,price:"â‚©â‚©",hours:"11:30~21:00",closed:"í™”",menu:"ìš°ìœ¡íƒ•ë©´, ê°€ì§€íŠ€ê¹€",tip:"ë¯¸ì‰ë¦° ë¹•êµ¬ë¥´ë§! í‰ì¼ 12ì‹œ ì „ ë„ì°© ì¶”ì²œ.",lat:35.1530,lng:129.1195,visited:false,day:1,book:{required:true,how:"ìºì¹˜í…Œì´ë¸” ì•± ë˜ëŠ” í˜„ì¥ ì›¨ì´íŒ…",url:"https://app.catchtable.co.kr",tip:"ì£¼ë§ ì›¨ì´íŒ… 30ë¶„+. 11ì‹œ 20ë¶„ ë„ì°©ì´ ì•ˆì „!"}},
{id:'s5',cat:"food",city:"gwangalli",name:"ë¹„ë¹„ì¬",rating:4.5,price:"â‚©",hours:"11:00~21:00",menu:"ìœ¡ì „ë¹„ë¹”ë°¥",tip:"ê¹”ë”í•œ ë¹„ë¹”ë°¥. íšŒì „ ë¹ ë¦„!",lat:35.1528,lng:129.1185,visited:false,day:1},
// == DAY 2 ë§›ì§‘ (ì›”ìš”ì¼) ==
{id:'s6',cat:"food",city:"nampo",name:"ì˜ë™ë°€ë©´",rating:4.4,price:"â‚©",hours:"10:00~21:30",menu:"ë°€ë©´, ë§Œë‘",tip:"ë¶€ì‚°ì—­ ì•! ì«„ê¹ƒí•œ ë°€ë©´ì´ ëŒ€í‘œ.",lat:35.1154,lng:129.0408,visited:false,day:2},
{id:'s7',cat:"food",city:"nampo",name:"ë™ë˜í• ë§¤íŒŒì „",rating:4.3,price:"â‚©â‚©",hours:"10:30~22:00",menu:"í•´ë¬¼íŒŒì „, ë™ë™ì£¼",tip:"ë¶€ì‚° ëŒ€í‘œ íŒŒì „! ë°”ì‚­í•˜ê³  ë‘íˆ¼.",lat:35.0980,lng:129.0337,visited:false,day:2},
{id:'s8',cat:"food",city:"nampo",name:"ì‚¼ì§„ì–´ë¬µ ë³¸ì ",rating:4.5,price:"â‚©",hours:"09:00~21:00",menu:"ì–´ë¬µê³ ë¡œì¼€, ì–´ë¬µíƒ•",tip:"ê¸°ë…í’ˆìœ¼ë¡œë„ ì¸ê¸°! ì–´ë¬µê³ ë¡œì¼€ í•„ìˆ˜.",lat:35.0978,lng:129.0286,visited:false,day:2},
{id:'s9',cat:"food",city:"yeongdo",name:"ì˜ë„í•´ë…€ì´Œ",rating:4.2,price:"â‚©â‚©",hours:"09:00~21:00",menu:"ì„±ê²Œì•Œê¹€ë°¥, í•´ì‚°ë¬¼",tip:"í•´ë…€ë“¤ì´ ì§ì ‘ ì¡ì€ í•´ì‚°ë¬¼!",lat:35.0727,lng:129.0686,visited:false,day:2},
// == DAY 1 ê´€ê´‘ ==
{id:'s10',cat:"sight",city:"haeundae",name:"í•´ìš´ëŒ€í•´ìˆ˜ìš•ì¥",rating:4.5,price:"ë¬´ë£Œ",menu:"ë°±ì‚¬ì¥ ì‚°ì±…, ë°”ë‹¤ ë·°",tip:"ë¶€ì‚° ëŒ€í‘œ í•´ë³€! ì•„ì¹¨ ì‚°ì±… ì¶”ì²œ.",lat:35.1587,lng:129.1604,visited:false,day:1},
{id:'s11',cat:"sight",city:"haeundae",name:"ë™ë°±ì„¬ í•´ì•ˆì‚°ì±…ë¡œ",rating:4.7,price:"ë¬´ë£Œ",hours:"24ì‹œê°„",menu:"ëˆ„ë¦¬ë§ˆë£¨, ë“±ëŒ€, í•´ì•ˆ ì ˆê²½",tip:"í•œ ë°”í€´ 40ë¶„. í•´ìš´ëŒ€~ê´‘ì•ˆëŒ€êµ íŒŒë…¸ë¼ë§ˆ!",lat:35.1531,lng:129.1538,visited:false,day:1},
{id:'s12',cat:"sight",city:"gwangalli",name:"ê´‘ì•ˆë¦¬í•´ìˆ˜ìš•ì¥",rating:4.6,price:"ë¬´ë£Œ",menu:"ê´‘ì•ˆëŒ€êµ ì•¼ê²½, í•´ë³€ ì‚°ì±…",tip:"ì„ì–‘+ì•¼ê²½ ëª¨ë‘ ì•„ë¦„ë‹¤ì›Œìš”! ì €ë… í•„ìˆ˜.",lat:35.1532,lng:129.1186,visited:false,day:1},
{id:'s13',cat:"sight",city:"gwangalli",name:"ë¯¼ë½ìˆ˜ë³€ê³µì›",rating:4.5,price:"ë¬´ë£Œ",hours:"24ì‹œê°„",menu:"ê´‘ì•ˆëŒ€êµ ë·°, í”¼í¬ë‹‰",tip:"ì•¼ê²½ ëª…ì†Œ! í¸ì˜ì  ì‚¬ì™€ì„œ ì¹˜ë§¥ í”¼í¬ë‹‰ ê°€ëŠ¥.",lat:35.1491,lng:129.1275,visited:false,day:1},
{id:'s14',cat:"sight",city:"haeundae",name:"í•´ìš´ëŒ€ ë¸”ë£¨ë¼ì¸íŒŒí¬",rating:4.4,price:"â‚©â‚©",hours:"09:30~18:00",menu:"í•´ë³€ì—´ì°¨, ìŠ¤ì¹´ì´ìº¡ìŠ",tip:"ì‚¬ì „ ì˜ˆì•½ í•„ìˆ˜! ë¯¸í¬â†’ì²­ì‚¬í¬ êµ¬ê°„ ì¶”ì²œ.",lat:35.1628,lng:129.1784,visited:false,day:1,book:{required:true,how:"ê³µì‹ í™ˆí˜ì´ì§€ ì˜ˆì•½",url:"https://www.bluelinepark.com",tip:"ë‹¹ì¼ í˜„ì¥ ë°œê¶Œ ì–´ë ¤ì›€! 2~3ì¼ ì „ ì˜ˆì•½ ì¶”ì²œ. 3ì¸ ìŠ¤ì¹´ì´ìº¡ìŠ 45,000ì›."}},
// == DAY 2 ê´€ê´‘ ==
{id:'s15',cat:"sight",city:"yeongdo",name:"í°ì—¬ìš¸ë¬¸í™”ë§ˆì„",rating:4.4,price:"ë¬´ë£Œ",menu:"í•´ì•ˆ ì ˆë²½ ìœ„ ë§ˆì„, ë²½í™”",tip:"ì˜ë„ ê°ì„±! ì˜í™” 'ë²”ì£„ì™€ì˜ ì „ìŸ' ì´¬ì˜ì§€.",lat:35.0781,lng:129.0456,visited:false,day:2},
{id:'s16',cat:"sight",city:"nampo",name:"ê°ì²œë¬¸í™”ë§ˆì„",rating:4.2,price:"ë¬´ë£Œ",menu:"ì•Œë¡ë‹¬ë¡ ë§ˆì„, ë²½í™”",tip:"'í•œêµ­ì˜ ì‚°í† ë¦¬ë‹ˆ'. ì–´ë¦°ì™•ì í¬í† ì¡´!",lat:35.0974,lng:129.0105,visited:false,day:2},
{id:'s17',cat:"sight",city:"nampo",name:"ìê°ˆì¹˜ì‹œì¥",rating:4.3,price:"ë¬´ë£Œ",menu:"í™œì–´íšŒ, í•´ì‚°ë¬¼ êµ¬ê²½",tip:"2ì¸µì—ì„œ íšŒ ë¨¹ê¸° ê°€ëŠ¥. í¥ì •ì€ ê¸°ë³¸!",lat:35.0965,lng:129.0305,visited:false,day:2},
{id:'s18',cat:"sight",city:"nampo",name:"BIFFê´‘ì¥",rating:4.0,price:"ë¬´ë£Œ",menu:"ì”¨ì•—í˜¸ë–¡, ê±°ë¦¬ êµ¬ê²½",tip:"ë‚¨í¬ë™ ì¤‘ì‹¬! ì”¨ì•—í˜¸ë–¡ 3000ì›.",lat:35.0983,lng:129.0286,visited:false,day:2},
{id:'s19',cat:"sight",city:"nampo",name:"ìš©ë‘ì‚°ê³µì›/ë¶€ì‚°íƒ€ì›Œ",rating:4.5,price:"â‚©",hours:"10:00~22:00",menu:"ì „ë§ëŒ€, ì•¼ê²½",tip:"ë‚¨í¬ë™ ì „ê²½ í•œëˆˆì—! ì €ë… ì•¼ê²½ ì¶”ì²œ.",lat:35.1006,lng:129.0322,visited:false,day:2},
{id:'s20',cat:"sight",city:"nampo",name:"ì†¡ë„í•´ìƒì¼€ì´ë¸”ì¹´",rating:4.4,price:"â‚©â‚©",hours:"09:00~22:00",menu:"ë°”ë‹¤ ìœ„ ì¼€ì´ë¸”ì¹´",tip:"íˆ¬ëª…ë°”ë‹¥ í¬ë¦¬ìŠ¤íƒˆìºë¹ˆ ì¶”ì²œ! ì™•ë³µ 20ë¶„.",lat:35.0762,lng:129.0176,visited:false,day:2,book:{required:true,how:"ê³µì‹ í™ˆí˜ì´ì§€ ë˜ëŠ” í˜„ì¥ ë°œê¶Œ",url:"https://busanaircruise.co.kr",tip:"ì£¼ë§ ëŒ€ê¸° 30ë¶„+. ì˜¨ë¼ì¸ ì˜ˆì•½ ì¶”ì²œ!"}},
// == ì¹´í˜ ==
{id:'c1',cat:"cafe",city:"haeundae",name:"ì¹´í˜ ìŠ¬ë¡œìš°íŒŒí¬",rating:4.6,price:"â‚©â‚©",hours:"10:00~22:00",menu:"í¬ë¡œí”Œ, í”Œë«í™”ì´íŠ¸",tip:"í•´ìš´ëŒ€ ì˜¤ì…˜ë·° ë£¨í”„íƒ‘! ì¼ëª° íƒ€ì´ë° ì¶”ì²œ.",lat:35.1598,lng:129.1438,visited:false,day:1},
{id:'c2',cat:"cafe",city:"gwangalli",name:"ì˜¨ë”ì„ ì…‹",rating:4.5,price:"â‚©â‚©",hours:"11:00~23:00",menu:"ë””ì €íŠ¸, ì»¤í”¼",tip:"ê´‘ì•ˆëŒ€êµ ì •ë©´ ë·°! ì„ì–‘ ëª…ì†Œ.",lat:35.1539,lng:129.1208,visited:false,day:1},
{id:'c3',cat:"cafe",city:"haeundae",name:"ë”¥í”Œë¡œìš°ì»¤í”¼",rating:4.7,price:"â‚©",hours:"10:00~20:00",menu:"í•¸ë“œë“œë¦½, í”Œë«í™”ì´íŠ¸",tip:"í•´ìš´ëŒ€ ë¡œì»¬ í™ì¹´í˜. ìì²´ ë¡œìŠ¤íŒ…!",lat:35.1602,lng:129.1621,visited:false,day:1},
{id:'c4',cat:"cafe",city:"yeongdo",name:"ëª¨ëª¨ìŠ¤ì»¤í”¼ ë³¸ì ",rating:4.6,price:"â‚©â‚©",hours:"09:00~21:00",menu:"ì—ìŠ¤í”„ë ˆì†Œ, í¬ë£¨ì•„ìƒ",tip:"ì˜ë„ ìŠ¤í˜ì…œí‹° ì„±ì§€. ë¶€ì‚° ëŒ€í‘œ ì¹´í˜!",lat:35.0879,lng:129.0395,visited:false,day:2},
{id:'c5',cat:"cafe",city:"nampo",name:"ë¸”ë£¨ë¹ˆì»¤í”¼",rating:4.4,price:"â‚©",hours:"10:00~20:00",menu:"ë“œë¦½ì»¤í”¼, ë² ì´ì»¤ë¦¬",tip:"íƒœì¢…ëŒ€ ê°€ëŠ” ê¸¸ ì‰¬ì–´ê°€ê¸° ì¢‹ì•„ìš”.",lat:35.0753,lng:129.0440,visited:false,day:2}
];

// ===== DAY DATA =====
const SEED_DAYS=[
{day:1,city:'haeundae',title:'í•´ìš´ëŒ€Â·ê´‘ì•ˆë¦¬',sub:'ë°”ë‹¤ ì‚°ì±… & ì•¼ê²½',stops:[
  {order:0,cat:'sight',name:'í•´ìš´ëŒ€í•´ìˆ˜ìš•ì¥',nameEn:'Haeundae Beach',lat:35.1587,lng:129.1604,tm:'09:30',dur:'60ë¶„',note:'ì•„ì¹¨ ë°”ë‹¤ ì‚°ì±…. í•œì í•œ ë°±ì‚¬ì¥ ì¦ê¸°ê¸°!'},
  {order:1,cat:'cafe',name:'â˜• ë”¥í”Œë¡œìš°ì»¤í”¼',nameEn:'ë”¥í”Œë¡œìš°ì»¤í”¼',lat:35.1602,lng:129.1621,tm:'10:30',dur:'40ë¶„',note:'í•´ìš´ëŒ€ ë¡œì»¬ í™ì¹´í˜ì—ì„œ ëª¨ë‹ì»¤í”¼'},
  {order:2,cat:'sight',name:'ë™ë°±ì„¬ í•´ì•ˆì‚°ì±…ë¡œ',nameEn:'ë™ë°±ì„¬ í•´ì•ˆì‚°ì±…ë¡œ',lat:35.1531,lng:129.1538,tm:'11:30',dur:'60ë¶„',note:'ëˆ„ë¦¬ë§ˆë£¨ APECí•˜ìš°ìŠ¤ â†’ í•´ì•ˆì ˆë²½ â†’ ë“±ëŒ€'},
  {order:3,cat:'food',name:'ğŸ½ï¸ ìˆ˜ë³€ìµœê³ ë¼ì§€êµ­ë°¥',nameEn:'ìˆ˜ë³€ìµœê³ ë¼ì§€êµ­ë°¥',lat:35.1537,lng:129.1178,tm:'13:00',dur:'50ë¶„',note:'í•­ì •êµ­ë°¥ìœ¼ë¡œ ë“ ë“ í•œ ì ì‹¬!'},
  {order:4,cat:'sight',name:'ê´‘ì•ˆë¦¬í•´ìˆ˜ìš•ì¥',nameEn:'ê´‘ì•ˆë¦¬í•´ìˆ˜ìš•ì¥',lat:35.1532,lng:129.1186,tm:'14:30',dur:'90ë¶„',note:'í•´ë³€ ì‚°ì±… + ì£¼ë³€ ê³¨ëª© íƒë°©'},
  {order:5,cat:'cafe',name:'â˜• ì˜¨ë”ì„ ì…‹',nameEn:'ì˜¨ë”ì„ ì…‹',lat:35.1539,lng:129.1208,tm:'16:30',dur:'60ë¶„',note:'ê´‘ì•ˆëŒ€êµ ë·° ì¹´í˜ì—ì„œ ì„ì–‘ ê°ìƒ'},
  {order:6,cat:'food',name:'ğŸ½ï¸ ìœµìº‰ì°Œì—',nameEn:'ìœµìº‰ì°Œì—',lat:35.1530,lng:129.1195,tm:'18:00',dur:'60ë¶„',note:'ë¯¸ì‰ë¦° ë¹•êµ¬ë¥´ë§! ìš°ìœ¡íƒ•ë©´ ì¶”ì²œ'},
  {order:7,cat:'sight',name:'ë¯¼ë½ìˆ˜ë³€ê³µì›',nameEn:'ë¯¼ë½ìˆ˜ë³€ê³µì›',lat:35.1491,lng:129.1275,tm:'19:30',dur:'60ë¶„',note:'ê´‘ì•ˆëŒ€êµ ì•¼ê²½ ê°ìƒ. í¸ì˜ì  ì¹˜ë§¥ í”¼í¬ë‹‰!'}
]},
{day:2,city:'nampo',title:'ì˜ë„Â·ë‚¨í¬ë™',sub:'ê°ì„± ë§ˆì„ & ë¡œì»¬ ë§›ì§‘',stops:[
  {order:0,cat:'cafe',name:'â˜• ëª¨ëª¨ìŠ¤ì»¤í”¼ ë³¸ì ',nameEn:'ëª¨ëª¨ìŠ¤ì»¤í”¼ ë³¸ì ',lat:35.0879,lng:129.0395,tm:'09:30',dur:'50ë¶„',note:'ì˜ë„ ìŠ¤í˜ì…œí‹° ì»¤í”¼ ì„±ì§€ì—ì„œ ì•„ì¹¨!'},
  {order:1,cat:'sight',name:'í°ì—¬ìš¸ë¬¸í™”ë§ˆì„',nameEn:'í°ì—¬ìš¸ë¬¸í™”ë§ˆì„',lat:35.0781,lng:129.0456,tm:'10:30',dur:'60ë¶„',note:'í•´ì•ˆ ì ˆë²½ ìœ„ ë§ˆì„ ì‚°ì±…. ì˜í™” ì´¬ì˜ì§€!'},
  {order:2,cat:'food',name:'ğŸ½ï¸ ì˜ë„í•´ë…€ì´Œ',nameEn:'ì˜ë„í•´ë…€ì´Œ',lat:35.0727,lng:129.0686,tm:'12:00',dur:'60ë¶„',note:'ì„±ê²Œì•Œê¹€ë°¥ + ì‹ ì„  í•´ì‚°ë¬¼'},
  {order:3,cat:'sight',name:'ê°ì²œë¬¸í™”ë§ˆì„',nameEn:'ê°ì²œë¬¸í™”ë§ˆì„',lat:35.0974,lng:129.0105,tm:'13:30',dur:'90ë¶„',note:'ì•Œë¡ë‹¬ë¡ ë§ˆì„! ì–´ë¦°ì™•ì í¬í† ì¡´'},
  {order:4,cat:'sight',name:'BIFFê´‘ì¥',nameEn:'BIFFê´‘ì¥',lat:35.0983,lng:129.0286,tm:'15:30',dur:'40ë¶„',note:'ì”¨ì•—í˜¸ë–¡ + ë‚¨í¬ë™ ê±°ë¦¬ êµ¬ê²½'},
  {order:5,cat:'food',name:'ğŸ½ï¸ ì‚¼ì§„ì–´ë¬µ ë³¸ì ',nameEn:'ì‚¼ì§„ì–´ë¬µ ë³¸ì ',lat:35.0978,lng:129.0286,tm:'16:30',dur:'30ë¶„',note:'ì–´ë¬µê³ ë¡œì¼€! ê¸°ë…í’ˆë„ ì—¬ê¸°ì„œ'},
  {order:6,cat:'sight',name:'ìê°ˆì¹˜ì‹œì¥',nameEn:'ìê°ˆì¹˜ì‹œì¥',lat:35.0965,lng:129.0305,tm:'17:00',dur:'60ë¶„',note:'í™œì–´íšŒ êµ¬ê²½ + 2ì¸µì—ì„œ ì €ë… íšŒ!'},
  {order:7,cat:'food',name:'ğŸ½ï¸ ë™ë˜í• ë§¤íŒŒì „',nameEn:'ë™ë˜í• ë§¤íŒŒì „',lat:35.0980,lng:129.0337,tm:'18:30',dur:'60ë¶„',note:'ë§ˆë¬´ë¦¬ëŠ” í•´ë¬¼íŒŒì „ + ë™ë™ì£¼!'}
]}
];

// ===== STATE =====
var cur=0,sel=null,gmap,gmks=[],gpath,gIW,pMap,pMks=[];
var pFilter='all',pViewMode='list',_fDay=0;
window._places=[];window._days=[];

// ===== LOCAL STORAGE =====
function lsGet(k){try{return JSON.parse(localStorage.getItem(k))}catch(e){return null}}
function lsSet(k,v){localStorage.setItem(k,JSON.stringify(v))}

window.savePlaces=function(){lsSet(LS_PLACES,window._places);};
window.saveDay=function(id,d){lsSet(LS_DAYS,window._days);};

// ===== INIT =====
function loadAll(){
  if(!lsGet(LS_PLACES)){
    window._places=JSON.parse(JSON.stringify(SEED_PLACES));
    savePlaces();
  }else{
    window._places=lsGet(LS_PLACES);
    // Merge new seed places
    SEED_PLACES.forEach(function(sp){
      if(!window._places.find(p=>p.id===sp.id))window._places.push(sp);
    });
    savePlaces();
  }
  if(!lsGet(LS_DAYS)){
    window._days=JSON.parse(JSON.stringify(SEED_DAYS));
    lsSet(LS_DAYS,window._days);
  }else{window._days=lsGet(LS_DAYS);}
  renderDays();renderItinList();renderPlaces();
}

// ===== TABS =====
window.mainTab=function(t){
  document.getElementById('itinPanel').classList.toggle('v',t==='itin');
  document.getElementById('placesPanel').classList.toggle('v',t==='places');
  document.getElementById('mt1').classList.toggle('on',t==='itin');
  document.getElementById('mt2').classList.toggle('on',t==='places');
  if(t==='itin')updateItinMap();
  if(t==='places'&&pViewMode==='map')setTimeout(()=>{if(pMap){google.maps.event.trigger(pMap,'resize');}},100);
};
window.itinView=function(v){
  document.getElementById('lw').classList.toggle('v',v==='list');
  document.getElementById('mw').classList.toggle('v',v==='map');
  document.getElementById('iv1').classList.toggle('on',v==='map');
  document.getElementById('iv2').classList.toggle('on',v==='list');
  if(v==='map'){setTimeout(function(){if(gmap){google.maps.event.trigger(gmap,'resize');updateItinMap();}},150);}
};

// ===== DAY BUTTONS =====
function renderDays(){
  var h='';
  window._days.forEach(function(d,i){
    h+='<button class="db'+(i===cur?' on':'')+'" onclick="pickDay('+i+')"><b>Day '+d.day+'</b> <span class="c">'+d.sub+'</span></button>';
  });
  document.getElementById('dy').innerHTML=h;
}
window.pickDay=function(i){cur=i;sel=null;renderDays();renderItinList();updateItinMap();};

// ===== ITINERARY LIST =====
function renderItinList(){
  var d=window._days[cur];if(!d)return;
  var stops=d.stops||[];
  var h='<div class="dh"><h2>Day '+d.day+' Â· '+d.title+'</h2><p>'+d.sub+' Â· '+(stops.length)+'ê°œ ìŠ¤í†±</p></div>';
  stops.forEach(function(x,i){
    var ac=sel===i?' on':'';
    var catClass=x.cat||'sight';
    h+='<div class="st'+ac+'" onclick="pickStop('+i+')" id="s'+i+'">';
    h+='<div class="sn '+catClass+'">'+(i+1)+'</div>';
    var bookMatch=null;
    var places=window._places||[];
    var placeMatch=x.nameEn?places.find(function(p){return p.name===x.nameEn||p.nameEn===x.nameEn;}):null;
    if(!placeMatch&&x.nameEn){placeMatch=places.find(function(p){return x.nameEn.indexOf(p.name)>=0||p.name.indexOf(x.nameEn)>=0;});}
    if(placeMatch&&placeMatch.book&&placeMatch.book.required)bookMatch=placeMatch;
    if(!bookMatch&&x.note&&x.note.indexOf('ì˜ˆì•½')>=0){bookMatch={book:{required:true,how:'',tip:x.note}};}
    var bookTag=bookMatch?'<span class="book-badge" onclick="event.stopPropagation();toggleItinBook('+i+')" style="margin-left:4px">ğŸ« ì˜ˆì•½</span>':'';
    var costTag='';
    if(placeMatch&&placeMatch.price){costTag='<span style="display:inline-block;margin-left:4px;padding:1px 5px;border-radius:4px;font-size:9px;font-weight:700;background:rgba(34,197,94,.12);color:#22c55e;vertical-align:middle">'+placeMatch.price+'</span>';}
    h+='<div class="si"><div class="nm">'+x.name+bookTag+costTag+'<br><span class="ne">'+(x.nameEn||'')+'</span></div>';
    h+='<div class="sm"><span class="tm">'+(x.tm||'')+'</span><span>'+(x.dur||'')+'</span></div>';
    if(x.note)h+='<div class="nt">'+x.note+'</div>';
    if(bookMatch&&bookMatch.book){
      h+='<div class="book-tip" id="ib_'+i+'" style="display:none"><div class="bt-title">ğŸ« ì˜ˆì•½ ì•ˆë‚´</div>';
      if(bookMatch.book.how)h+='<div>ğŸ“Œ '+bookMatch.book.how+'</div>';
      if(bookMatch.book.tip)h+='<div>ğŸ’¡ '+bookMatch.book.tip+'</div>';
      if(bookMatch.book.url)h+='<div style="margin-top:4px"><a href="'+bookMatch.book.url+'" target="_blank">ğŸ”— ì˜ˆì•½ í˜ì´ì§€ ì—´ê¸°</a></div>';
      h+='</div>';
    }
    h+='<div class="st-actions">';
    if(i>0)h+='<button class="sa up" onclick="event.stopPropagation();moveStop('+i+',-1)">â†‘ ìœ„ë¡œ</button>';
    if(i<stops.length-1)h+='<button class="sa down" onclick="event.stopPropagation();moveStop('+i+',1)">â†“ ì•„ë˜</button>';
    h+='<button class="sa del" onclick="event.stopPropagation();removeStop('+i+')">ğŸ—‘ï¸ ì‚­ì œ</button>';
    h+='</div></div></div>';
  });
  h+='<button class="add-stop" onclick="openDayModal()">+ ì €ì¥ì†Œì—ì„œ ì¶”ê°€</button>';
  // Daily cost summary
  var totalCost=0;var costDetails=[];
  stops.forEach(function(x){
    var places=window._places||[];
    var pm=x.nameEn?places.find(function(p){return p.name===x.nameEn||x.nameEn.indexOf(p.name)>=0||p.name.indexOf(x.nameEn)>=0;}):null;
    if(pm&&pm.price){
      var p=pm.price;var est=0;
      if(p==='ë¬´ë£Œ'||p==='Free')est=0;
      else if(p.match(/^[â‚©\d]/)){var m=p.match(/\d+/);if(m)est=parseInt(m[0])*1000;}
      if(p==='â‚©')est=10000;else if(p==='â‚©â‚©')est=25000;else if(p==='â‚©â‚©â‚©')est=40000;
      if(est>0){totalCost+=est;costDetails.push(x.name.replace(/[ğŸ½ï¸â˜•]\s*/g,'')+'~'+Math.round(est/1000)+'ì²œ');}
    }
  });
  if(totalCost>0){
    h+='<div style="margin:10px 0;padding:10px 12px;background:rgba(34,197,94,.08);border:1px solid rgba(34,197,94,.2);border-radius:8px;font-size:11px;line-height:1.6">';
    h+='<div style="font-weight:700;color:#22c55e;margin-bottom:4px">ğŸ’° ì˜ˆìƒ ë¹„ìš© (1ì¸ ê¸°ì¤€)</div>';
    h+='<div style="color:var(--dm)">'+costDetails.join(' Â· ')+'</div>';
    h+='<div style="font-weight:700;color:var(--tx);margin-top:4px">í•©ê³„ ~'+Math.round(totalCost/1000)+'ì²œì›/1ì¸ Â· 3ì¸ ~'+Math.round(totalCost*3/1000)+'ì²œì›</div>';
    h+='</div>';
  }
  // Recommended places
  var dayNum=d.day;
  var stopNames=stops.map(function(x){return x.nameEn||x.name||'';});
  var recs=(window._places||[]).filter(function(p){
    return p.day===dayNum&&!stopNames.find(function(sn){return sn.indexOf(p.name)>=0||p.name.indexOf(sn.replace(/[ğŸ½ï¸â˜•]\s*/g,''))>=0;});
  });
  if(recs.length>0){
    h+='<div style="margin:10px 0;padding:10px 12px;background:rgba(56,189,248,.08);border:1px solid rgba(56,189,248,.2);border-radius:8px;font-size:11px;line-height:1.8">';
    h+='<div style="font-weight:700;color:var(--acc);margin-bottom:6px">ğŸ’¡ ì´ ë‚  ì¶”ê°€í•˜ë©´ ì¢‹ì€ ì¥ì†Œ</div>';
    recs.forEach(function(r){
      var icon=r.cat==='food'?'ğŸ½ï¸':r.cat==='cafe'?'â˜•':'ğŸ›ï¸';
      var priceTag=r.price?' <span style="color:#22c55e;font-size:9px">'+r.price+'</span>':'';
      var bookTag=(r.book&&r.book.required)?' <span style="color:#ef4444;font-size:9px">ì˜ˆì•½</span>':'';
      h+='<div style="display:flex;justify-content:space-between;align-items:center;padding:4px 0;border-bottom:1px solid rgba(255,255,255,.05)">';
      h+='<div>'+icon+' <b>'+r.name+'</b>'+priceTag+bookTag;
      if(r.tip)h+='<div style="color:var(--dm);font-size:10px">'+r.tip+'</div>';
      h+='</div>';
      h+='<button onclick="event.stopPropagation();addRecToDay(\''+r.id+'\')" style="flex-shrink:0;padding:4px 10px;border:1px solid var(--acc);background:transparent;color:var(--acc);border-radius:6px;font-size:10px;font-weight:700;cursor:pointer">+ ì¶”ê°€</button>';
      h+='</div>';
    });
    h+='</div>';
  }
  document.getElementById('ls').innerHTML=h;
}

window.toggleItinBook=function(i){var el=document.getElementById('ib_'+i);if(el)el.style.display=el.style.display==='none'?'block':'none';};
window.pickStop=function(i){
  sel=sel===i?null:i;renderItinList();
  if(sel!==null){var x=(window._days[cur].stops||[])[sel];if(x&&x.lat){gmap.panTo({lat:x.lat,lng:x.lng});gmap.setZoom(16);}
    var el=document.getElementById('s'+sel);if(el)el.scrollIntoView({behavior:'smooth',block:'center'});}
};
window.moveStop=function(idx,dir){
  var d=window._days[cur];var stops=d.stops||[];
  var ni=idx+dir;if(ni<0||ni>=stops.length)return;
  var tmp=stops[idx];stops[idx]=stops[ni];stops[ni]=tmp;
  stops.forEach(function(s,i){s.order=i;});
  lsSet(LS_DAYS,window._days);
  renderItinList();try{updateItinMap();}catch(e){}
};
window.removeStop=function(idx){
  var d=window._days[cur];if(!d||!d.stops||idx<0||idx>=d.stops.length)return;
  d.stops.splice(idx,1);
  d.stops.forEach(function(s,i){s.order=i;});
  lsSet(LS_DAYS,window._days);
  sel=null;
  renderItinList();
  try{updateItinMap();}catch(e){}
};
window.addRecToDay=function(placeId){
  var p=(window._places||[]).find(function(x){return x.id===placeId;});
  if(!p)return;
  var d=window._days[cur];if(!d)return;
  var icon=p.cat==='food'?'ğŸ½ï¸ ':p.cat==='cafe'?'â˜• ':'';
  var newStop={order:d.stops.length,cat:p.cat,name:icon+p.name,nameEn:p.name,lat:p.lat,lng:p.lng,tm:'',dur:'60ë¶„',note:p.tip||''};
  d.stops.push(newStop);
  saveDay(d.id||'day'+d.day,d);renderItinList();updateItinMap();
};

// ===== MAP =====
window.initMap=function(){
  // Temporarily show map div for proper initialization
  var mw=document.getElementById('mw');
  var wasHidden=!mw.classList.contains('v');
  if(wasHidden)mw.style.cssText='display:flex!important;flex-direction:column;position:absolute;left:-9999px;width:100%;height:300px';
  
  gmap=new google.maps.Map(document.getElementById('map'),{center:{lat:35.155,lng:129.13},zoom:13,disableDefaultUI:true,zoomControl:true,styles:[{elementType:'geometry',stylers:[{color:'#0a1628'}]},{elementType:'labels.text.stroke',stylers:[{color:'#0a1628'}]},{elementType:'labels.text.fill',stylers:[{color:'#6b8299'}]},{featureType:'water',elementType:'geometry',stylers:[{color:'#0f2540'}]},{featureType:'road',elementType:'geometry',stylers:[{color:'#1a2d4a'}]}]});
  gIW=new google.maps.InfoWindow();
  
  if(wasHidden){setTimeout(function(){mw.style.cssText='';},100);}
  
  google.maps.event.addListenerOnce(gmap,'idle',function(){
    updateItinMap();
  });
  loadAll();
};

function updateItinMap(){
  if(!gmap)return;
  gmks.forEach(m=>m.setMap(null));gmks=[];
  if(gpath)gpath.setMap(null);
  var d=window._days[cur];if(!d)return;
  var stops=d.stops||[];
  var path=[];
  var bounds=new google.maps.LatLngBounds();
  stops.forEach(function(x,i){
    if(!x.lat||!x.lng)return;
    var pos={lat:x.lat,lng:x.lng};
    path.push(pos);bounds.extend(pos);
    var colors={sight:'#3b82f6',food:'#22c55e',cafe:'#ec4899',lodge:'#f59e0b'};
    var c=colors[x.cat]||'#38bdf8';
    var mk=new google.maps.Marker({position:pos,map:gmap,label:{text:''+(i+1),color:'#fff',fontSize:'11px',fontWeight:'700'},icon:{path:google.maps.SymbolPath.CIRCLE,scale:14,fillColor:c,fillOpacity:1,strokeColor:'#fff',strokeWeight:2}});
    mk.addListener('click',function(){
      sel=i;renderItinList();
      var card=document.getElementById('mapCard');
      document.getElementById('mcNum').style.background=c;
      document.getElementById('mcNum').textContent=i+1;
      document.getElementById('mcName').textContent=x.name;
      document.getElementById('mcEn').textContent=x.nameEn||'';
      var meta='';
      if(x.tm)meta+='<span class="rt">'+x.tm+'</span>';
      if(x.dur)meta+='<span class="pr">'+x.dur+'</span>';
      document.getElementById('mcMeta').innerHTML=meta;
      document.getElementById('mcNote').textContent=x.note||'';
      card.classList.add('show');
    });
    gmks.push(mk);
  });
  if(path.length>1){
    gpath=new google.maps.Polyline({path:path,geodesic:true,strokeColor:'#38bdf8',strokeOpacity:.6,strokeWeight:3,map:gmap});
  }
  if(path.length)gmap.fitBounds(bounds,{top:20,bottom:200,left:20,right:20});
}
window.closeCard=function(){document.getElementById('mapCard').classList.remove('show');};
window.navCard=function(dir){
  var stops=window._days[cur].stops||[];
  var next=(sel||0)+dir;
  if(next<0||next>=stops.length)return;
  sel=next;
  gmks[sel]&&google.maps.event.trigger(gmks[sel],'click');
  gmap.panTo({lat:stops[sel].lat,lng:stops[sel].lng});
};

// ===== PLACES PANEL =====
function getFilteredList(){
  var list=window._places||[];
  if(pFilter==='food'||pFilter==='cafe'||pFilter==='sight')list=list.filter(p=>p.cat===pFilter);
  else if(pFilter==='d1')list=list.filter(p=>p.day===1);
  else if(pFilter==='d2')list=list.filter(p=>p.day===2);
  else if(pFilter==='unset')list=list.filter(p=>!p.day||p.day===0);
  return list;
}
function renderPlaces(){
  var list=getFilteredList();
  var h='';
  if(!list.length){h='<div class="empty">ì¥ì†Œê°€ ì—†ìŠµë‹ˆë‹¤</div>';document.getElementById('plist').innerHTML=h;return;}
  list.forEach(function(p){
    var icons={food:'ğŸ½ï¸',cafe:'â˜•',sight:'ğŸ›ï¸'};
    var icon=icons[p.cat]||'ğŸ“';
    h+='<div class="pcard'+(p.visited?' visited':'')+'">';
    h+='<div class="pcard-top"><div class="pcard-icon '+p.cat+'">'+icon+'</div>';
    h+='<div class="pcard-info"><div class="pcard-name">'+p.name;
    if(p.book&&p.book.required)h+=' <span class="book-badge" onclick="toggleBookTip(\''+p.id+'\')" style="margin-left:4px">ğŸ« ì˜ˆì•½</span>';
    h+='</div>';
    h+='<div class="pcard-meta">';
    if(p.rating)h+='<span style="background:rgba(56,189,248,.12);color:var(--acc)">â­ '+p.rating+'</span>';
    if(p.price)h+='<span style="background:rgba(34,197,94,.12);color:var(--gn)">'+p.price+'</span>';
    if(p.closed)h+='<span style="background:rgba(239,68,68,.12);color:var(--rd)">íœ´ë¬´:'+p.closed+'</span>';
    h+='</div>';
    h+='<div style="margin-top:4px">';
    if(p.day){h+='<span class="day-badge set" onclick="event.stopPropagation();openDaySet(\''+p.id+'\','+p.day+')">D'+p.day+'</span>';}
    else{h+='<span class="day-badge unset" onclick="event.stopPropagation();openDaySet(\''+p.id+'\',0)">ğŸ“…</span>';}
    h+='</div></div></div>';
    if(p.book&&p.book.required){
      h+='<div class="book-tip" id="bt_'+p.id+'" style="display:none"><div class="bt-title">ğŸ« ì˜ˆì•½ ì•ˆë‚´</div>';
      h+='<div>ğŸ“Œ '+p.book.how+'</div>';
      if(p.book.tip)h+='<div>ğŸ’¡ '+p.book.tip+'</div>';
      if(p.book.url)h+='<div style="margin-top:4px"><a href="'+p.book.url+'" target="_blank">ğŸ”— ì˜ˆì•½ í˜ì´ì§€ ì—´ê¸°</a></div>';
      h+='</div>';
    }
    h+='<div class="pcard-detail">';
    if(p.menu)h+='<div>ğŸ´ '+p.menu+'</div>';if(p.hours)h+='<div>ğŸ• '+p.hours+'</div>';if(p.tip)h+='<div>ğŸ’¡ '+p.tip+'</div>';
    h+='</div><div class="pcard-actions">';
    h+='<button class="pact visit'+(p.visited?' done':'')+'" onclick="toggleVisit(\''+p.id+'\','+p.visited+')">'+(p.visited?'âœ… ì™„ë£Œ':'â˜ ì²´í¬')+'</button>';
    h+='<button class="pact additin" onclick="openDayPicker(\''+p.id+'\')">ğŸ“… ì¼ì •ì¶”ê°€</button>';
    if(p.lat&&p.lng)h+='<button class="pact mapbtn" onclick="focusPmap('+p.lat+','+p.lng+')">ğŸ“</button>';
    h+='<button class="pact" style="background:rgba(56,189,248,.1);color:var(--acc)" onclick="editPlace(\''+p.id+'\')">âœï¸</button>';
    h+='<button class="pact del" onclick="deletePlace(\''+p.id+'\')">ğŸ—‘ï¸</button>';
    h+='</div></div>';
  });
  document.getElementById('plist').innerHTML=h;
}

window.toggleBookTip=function(id){var el=document.getElementById('bt_'+id);if(el)el.style.display=el.style.display==='none'?'block':'none';};
window.pf=function(f,el){
  pFilter=f;
  document.querySelectorAll('#pbar .pbtn, #pbar2 .pbtn').forEach(b=>b.classList.remove('on'));
  el.classList.add('on');
  if(f==='all')document.querySelector('#pbar .pbtn').classList.add('on');
  renderPlaces();
};
window.pview=function(v){
  pViewMode=v;
  document.getElementById('plist').style.display=v==='list'?'block':'none';
  document.getElementById('pmw').style.display=v==='map'?'flex':'none';
  document.getElementById('pv1').classList.toggle('on',v==='list');
  document.getElementById('pv2').classList.toggle('on',v==='map');
  if(v==='map')updatePmap(getFilteredList());
};

function updatePmap(list){
  if(!pMap){
    pMap=new google.maps.Map(document.getElementById('pmap'),{center:{lat:35.13,lng:129.08},zoom:12,disableDefaultUI:true,zoomControl:true,styles:[{elementType:'geometry',stylers:[{color:'#0a1628'}]},{elementType:'labels.text.stroke',stylers:[{color:'#0a1628'}]},{elementType:'labels.text.fill',stylers:[{color:'#6b8299'}]},{featureType:'water',elementType:'geometry',stylers:[{color:'#0f2540'}]},{featureType:'road',elementType:'geometry',stylers:[{color:'#1a2d4a'}]}]});
  }
  pMks.forEach(m=>m.setMap(null));pMks=[];
  var bounds=new google.maps.LatLngBounds();
  list.forEach(function(p){
    if(!p.lat||!p.lng)return;
    var pos={lat:p.lat,lng:p.lng};bounds.extend(pos);
    var colors={food:'#22c55e',cafe:'#ec4899',sight:'#3b82f6'};
    var mk=new google.maps.Marker({position:pos,map:pMap,icon:{path:google.maps.SymbolPath.CIRCLE,scale:10,fillColor:colors[p.cat]||'#38bdf8',fillOpacity:1,strokeColor:'#fff',strokeWeight:2}});
    mk.addListener('click',function(){
      var iw=new google.maps.InfoWindow({content:'<div class="iw"><h3>'+p.name+'</h3>'+(p.menu?'<p>'+p.menu+'</p>':'')+(p.tip?'<p>ğŸ’¡'+p.tip+'</p>':'')+'</div>'});
      iw.open(pMap,mk);
    });
    pMks.push(mk);
  });
  if(list.length)pMap.fitBounds(bounds,50);
}
window.focusPmap=function(lat,lng){
  pview('map');
  setTimeout(function(){pMap.panTo({lat:lat,lng:lng});pMap.setZoom(16);},200);
};

// DAY assignment
window.openDaySet=function(id,curDay){
  var h='<div style="font-size:13px;font-weight:600;margin-bottom:8px">ğŸ“… ëª‡ì¼ì°¨?</div><div class="day-pick-row">';
  [1,2].forEach(function(n){
    h+='<button class="'+(n===curDay?'active':'')+'" onclick="setPlaceDay(\''+id+'\','+n+')">'+n+'</button>';
  });
  h+='<button style="width:auto;padding:0 10px" onclick="setPlaceDay(\''+id+'\',0)">âœ•</button></div>';
  var cards=document.querySelectorAll('.pcard');
  var filtered=getFilteredList();
  var fi=filtered.findIndex(p=>p.id===id);
  if(fi>=0&&cards[fi]){
    var existing=cards[fi].querySelector('.day-pick-row');
    if(existing){existing.parentElement.remove();return;}
    var div=document.createElement('div');
    div.style.cssText='padding:6px 0';div.innerHTML=h;
    cards[fi].querySelector('.pcard-actions').before(div);
  }
};
window.setPlaceDay=function(id,day){
  var p=window._places.find(x=>x.id===id);
  if(p){p.day=day;savePlaces();renderPlaces();}
};

// ===== MODALS =====
window.openModal=function(){
  document.getElementById('modalTitle').textContent='ì¥ì†Œ ì¶”ê°€';
  document.getElementById('modal').dataset.editId='';
  ['fCat','fCity','fName','fRating','fPrice','fHours','fClosed','fMenu','fTip','fLat','fLng'].forEach(function(id){
    var el=document.getElementById(id);if(el.tagName==='SELECT')el.selectedIndex=0;else el.value='';
  });
  _fDay=0;updateFDayUI();
  document.getElementById('modal').classList.add('v');
};
window.closeModal=function(){document.getElementById('modal').classList.remove('v');};
window.pickFDay=function(n){_fDay=n;updateFDayUI();};
function updateFDayUI(){
  var btns=document.querySelectorAll('#fDayRow button');
  btns.forEach(function(b,i){b.classList.toggle('active',(i<2&&_fDay===(i+1))||(i===2&&_fDay===0));});
}

window.recommendDays=function(lat,lng){
  if(!lat||!lng)return[];
  var days=window._days||[];
  var results=[];
  days.forEach(function(d){
    var stops=d.stops||[];if(!stops.length)return;
    var minDist=999;
    stops.forEach(function(s){
      if(!s.lat||!s.lng)return;
      var dlat=lat-s.lat;var dlng=lng-s.lng;
      var dist=Math.sqrt(dlat*dlat+dlng*dlng)*111;
      if(dist<minDist)minDist=dist;
    });
    if(minDist<5){results.push({day:d.day,title:d.title,sub:d.sub,minDist:Math.round(minDist*100)/100});}
  });
  results.sort(function(a,b){return a.minDist-b.minDist;});
  return results;
};

window.savePlace=function(){
  var d={cat:document.getElementById('fCat').value,city:document.getElementById('fCity').value,name:document.getElementById('fName').value.trim(),rating:parseFloat(document.getElementById('fRating').value)||0,price:document.getElementById('fPrice').value,hours:document.getElementById('fHours').value.trim(),closed:document.getElementById('fClosed').value.trim(),menu:document.getElementById('fMenu').value.trim(),tip:document.getElementById('fTip').value.trim(),lat:parseFloat(document.getElementById('fLat').value)||0,lng:parseFloat(document.getElementById('fLng').value)||0,visited:false,createdAt:Date.now()};
  if(!d.name){alert('ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”');return;}
  var eid=document.getElementById('modal').dataset.editId;
  if(eid){var idx=window._places.findIndex(x=>x.id===eid);if(idx>=0){d.id=eid;d.visited=window._places[idx].visited;d.day=_fDay;window._places[idx]=d;}}
  else{d.id='p'+Date.now();d.day=_fDay;window._places.push(d);}
  savePlaces();closeModal();loadAll();
  if(d.lat&&d.lng){
    var recs=recommendDays(d.lat,d.lng);
    if(recs.length>0){setTimeout(function(){showDayRecToast(d.id,recs);},300);}
  }
};

window.showDayRecToast=function(placeId,recs){
  var existing=document.getElementById('dayRecToast');if(existing)existing.remove();
  var div=document.createElement('div');div.id='dayRecToast';
  div.style.cssText='position:fixed;bottom:16px;left:12px;right:12px;z-index:9999;background:#132038;border:1px solid var(--acc);border-radius:12px;padding:14px 16px;box-shadow:0 4px 24px rgba(0,0,0,.5);animation:fadeIn .3s';
  var p=(window._places||[]).find(function(x){return x.id===placeId;});
  var name=p?p.name:'ì¥ì†Œ';
  var h='<div style="font-weight:700;color:var(--acc);font-size:13px;margin-bottom:8px">ğŸ“… "'+name+'" ì¶”ì²œ ì¼ì •</div>';
  recs.forEach(function(r,i){
    var best=i===0?' style="color:var(--acc);font-weight:700"':'';
    h+='<div style="display:flex;justify-content:space-between;align-items:center;padding:5px 0;border-bottom:1px solid rgba(255,255,255,.06)">';
    h+='<div'+best+'>'+(i===0?'â­ ':'')+' Day '+r.day+' â€” '+r.sub+'</div>';
    h+='<div style="display:flex;gap:4px;align-items:center"><span style="font-size:10px;color:var(--dm)">'+r.minDist+'km</span>';
    h+='<button onclick="quickSetDay(\''+placeId+'\','+r.day+')" style="padding:3px 10px;border:1px solid var(--acc);background:transparent;color:var(--acc);border-radius:5px;font-size:10px;font-weight:700;cursor:pointer">D'+r.day+'</button></div>';
    h+='</div>';
  });
  h+='<div style="text-align:right;margin-top:8px"><button onclick="document.getElementById(\'dayRecToast\').remove()" style="padding:4px 14px;background:rgba(255,255,255,.1);border:none;color:var(--dm);border-radius:6px;font-size:11px;cursor:pointer">ë‹«ê¸°</button></div>';
  div.innerHTML=h;document.body.appendChild(div);
  setTimeout(function(){var t=document.getElementById('dayRecToast');if(t)t.remove();},15000);
};
window.quickSetDay=function(id,day){
  var p=(window._places||[]).find(function(x){return x.id===id;});
  if(p){p.day=day;savePlaces();renderPlaces();}
  var t=document.getElementById('dayRecToast');if(t)t.remove();
};

window.deletePlace=function(id){if(!confirm('ì‚­ì œ?'))return;window._places=window._places.filter(x=>x.id!==id);savePlaces();loadAll();};
window.toggleVisit=function(id,cur){var p=window._places.find(x=>x.id===id);if(p){p.visited=!cur;savePlaces();loadAll();}};
window.editPlace=function(id){
  var p=(window._places||[]).find(x=>x.id===id);if(!p)return;
  document.getElementById('modalTitle').textContent='ì¥ì†Œ ìˆ˜ì •';document.getElementById('modal').dataset.editId=id;
  document.getElementById('fCat').value=p.cat||'food';document.getElementById('fCity').value=p.city||'haeundae';
  document.getElementById('fName').value=p.name||'';
  document.getElementById('fRating').value=p.rating||'';document.getElementById('fPrice').value=p.price||'';
  document.getElementById('fHours').value=p.hours||'';document.getElementById('fClosed').value=p.closed||'';
  document.getElementById('fMenu').value=p.menu||'';document.getElementById('fTip').value=p.tip||'';
  document.getElementById('fLat').value=p.lat||'';document.getElementById('fLng').value=p.lng||'';
  _fDay=p.day||0;updateFDayUI();
  document.getElementById('modal').classList.add('v');
};

// DAY PICKER for adding to itinerary
var _addPlaceId='';
window.openDayPicker=function(id){
  _addPlaceId=id;
  var h='';
  window._days.forEach(function(d){
    h+='<button onclick="addToDay('+d.day+')"><b>Day '+d.day+'</b><br><span style="font-size:11px;color:var(--dm)">'+d.sub+'</span></button>';
  });
  document.getElementById('dayPick').innerHTML=h;
  document.getElementById('dayModal').classList.add('v');
};
window.closeDayModal=function(){document.getElementById('dayModal').classList.remove('v');};
window.addToDay=function(dayNum){
  var p=(window._places||[]).find(x=>x.id===_addPlaceId);
  if(!p)return;
  var d=window._days.find(x=>x.day===dayNum);if(!d)return;
  var icon=p.cat==='food'?'ğŸ½ï¸ ':p.cat==='cafe'?'â˜• ':'';
  d.stops.push({order:d.stops.length,cat:p.cat,name:icon+p.name,nameEn:p.name,lat:p.lat,lng:p.lng,tm:'',dur:'60ë¶„',note:p.tip||''});
  saveDay(d.id||'day'+d.day,d);
  closeDayModal();
  cur=window._days.indexOf(d);
  renderDays();renderItinList();updateItinMap();
  mainTab('itin');
};
window.openDayModal=function(){
  var h='';
  var places=window._places||[];
  var d=window._days[cur];if(!d)return;
  var dayPlaces=places.filter(p=>p.day===d.day);
  if(!dayPlaces.length){alert('ì €ì¥ì†Œì— Day '+d.day+' ì¥ì†Œê°€ ì—†ìŠµë‹ˆë‹¤.\nì €ì¥ì†Œ íƒ­ì—ì„œ ì¥ì†Œë¥¼ ì¶”ê°€í•˜ì„¸ìš”!');return;}
  dayPlaces.forEach(function(p){
    var icon=p.cat==='food'?'ğŸ½ï¸':p.cat==='cafe'?'â˜•':'ğŸ›ï¸';
    h+='<button onclick="addToDay('+d.day+');_addPlaceId=\''+p.id+'\'" style="text-align:left">'+icon+' <b>'+p.name+'</b><br><span style="font-size:11px;color:var(--dm)">'+(p.tip||'')+'</span></button>';
  });
  document.getElementById('dayPick').innerHTML=h;
  document.getElementById('dayModal').classList.add('v');
};

// EXPORT
window.openExport=function(){
  document.getElementById('expDay').textContent=window._days[cur].day;
  document.getElementById('exportModal').classList.add('v');
};
window.closeExport=function(){document.getElementById('exportModal').classList.remove('v');};
window.openInGmaps=function(type){
  var places=[];
  if(type==='day'){var d=window._days[cur];places=(d.stops||[]).filter(s=>s.lat&&s.lng);}
  else{places=(window._places||[]).filter(p=>p.cat===type&&p.lat&&p.lng);}
  if(!places.length){alert('ì¥ì†Œê°€ ì—†ìŠµë‹ˆë‹¤');return;}
  if(places.length===1){window.open('https://www.google.com/maps/search/?api=1&query='+places[0].lat+','+places[0].lng);return;}
  var origin=places[0].lat+','+places[0].lng;
  var dest=places[places.length-1].lat+','+places[places.length-1].lng;
  var waypoints=places.slice(1,-1).map(p=>p.lat+','+p.lng).join('|');
  var url='https://www.google.com/maps/dir/?api=1&origin='+origin+'&destination='+dest+(waypoints?'&waypoints='+waypoints:'')+'&travelmode=walking';
  window.open(url);
  closeExport();
};

// Google Places Autocomplete
function initAutocomplete(){
  if(typeof google==='undefined'||!google.maps||!google.maps.places)return;
  var input=document.getElementById('fSearch');
  var ac=new google.maps.places.Autocomplete(input,{types:['establishment'],componentRestrictions:{country:'kr'},fields:['name','geometry','formatted_address','rating','opening_hours','price_level']});
  ac.addListener('place_changed',function(){
    var place=ac.getPlace();if(!place||!place.geometry)return;
    document.getElementById('fName').value=place.name||'';
    document.getElementById('fLat').value=place.geometry.location.lat().toFixed(7);
    document.getElementById('fLng').value=place.geometry.location.lng().toFixed(7);
    if(place.rating)document.getElementById('fRating').value=place.rating;
    if(place.opening_hours&&place.opening_hours.weekday_text){
      var today=place.opening_hours.weekday_text[0]||'';
      var match=today.match(/\d{1,2}:\d{2}\s*[â€“-]\s*\d{1,2}:\d{2}/);
      if(match)document.getElementById('fHours').value=match[0].replace(/\s/g,'');
    }
  });
}

// LOAD
window.addEventListener('DOMContentLoaded',function(){loadAll();});
</script>
<script>
function loadGMaps(){
  var s=document.createElement('script');
  s.src='https://maps.googleapis.com/maps/api/js?key=AIzaSyD5Zq_g4MZmeTHi0hPIbQ5fp8-4P_nVVAY&libraries=places&callback=onGMapsLoaded';
  s.async=true;s.defer=true;document.head.appendChild(s);
}
window.onGMapsLoaded=function(){initMap();initAutocomplete();};
loadGMaps();
</script>
</body>
</html>
